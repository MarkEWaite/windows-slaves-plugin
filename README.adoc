= WMI Windows Agents Plugin for JenkinsÂ 

image:https://img.shields.io/jenkins/plugin/v/windows-slaves.svg[link="https://plugins.jenkins.io/windows-slaves"]
image:https://img.shields.io/github/release/jenkinsci/windows-slaves-plugin.svg?label=changelog[link="https://github.com/jenkinsci/windows-slaves-plugin/releases/latest"]
image:https://img.shields.io/jenkins/plugin/i/windows-slaves.svg?color=green[link="https://plugins.jenkins.io/windows-slaves"]

Allows you to setup agents on Windows machines over Windows Management Instrumentation (WMI).

== NOTICE OF DEPRECATION (May 2023) ==

This plugin will be deprecated in May of 2023. SSH is now a very viable, secure and robust solution for connecting to Windows based agents using native Windows binaries for https://github.com/PowerShell/openssh-portable[OpenSSH Server] or another method such as https://www.cygwin.com/[cygwin]. There is also the https://plugins.jenkins.io/windows-cloud/[Windows Cloud plugin] for Jenkins which uses WinRM, a more modern remote management solution. 

The method for connecting agents to the controller in this plugin, which is based on DCOM, has several pitfalls and issues and can be brittle. The SSH and other solutions can unify the method for connecting to all agents (Windows, Linux, macOS, etc.) in your infrastructure. It is highly recommended that you migrate to one of these other methods soone rather than later.

Mirosoft is tightening security on DCOM based on a https://support.microsoft.com/en-us/topic/kb5004442-manage-changes-for-windows-dcom-server-security-feature-bypass-cve-2021-26414-f1400b52-c141-43d2-941e-37ed901c769c[CVE]. Initial OS updates will require a registry change to enable the current security level, then in May of 2023 they will not have a way to override the secure behavior. The library used in this plugin was last released in ~2010 and does not have an active development team. Jenkins developers have decided to deprecate this plugin rather than try and maintain the library on our own, which requires a significant understanding of the underlying DCOM technologies.

If someone would like to keep the plugin going, they would need to adopt the plugin and update it to align with the changes that Microsoft is putting in to resolve the CVE.

== Usage

Once the plugin is installed, a new launch type is available in the agent configuration.
Once the agent configuration is saved,
Jenkins will reconnect the agent using the plugin.

image:docs/images/configuration.png[]

== How does it work?

This section goes into the details of how the managed Windows agent launcher actually works.

This launcher uses several protocols that has been around for a quite some time.

* It first uses http://en.wikipedia.org/wiki/Server_Message_Block[CIFS] (also known as "Windows file share protocol") to push files into the
agent. 
When used by someone with administrative privileges, Windows file shares expose what's commonly known as "administrative shares",
which are hidden exported directories that cover every drive in the system.
* It then uses
http://en.wikipedia.org/wiki/Distributed_Component_Object_Model[DCOM] to
talk to
http://en.wikipedia.org/wiki/Windows_Management_Instrumentation[WMI] to
install and start a service remotely.
* Jenkins uses two services, one is called
https://github.com/jenkinsci/lib-windows-remote-command[Remote Communication Service] and this provides a general-purpose remote command execution capability. 
Jenkins uses this to check if Java is available and if not install it. 
A failure to do this is not fatal problem, as Jenkins will proceed by assuming that Java is available in a reasonable place.
This service is destroyed after it is used so as not to cause any harm to the security. 
The communication between Jenkins controller and this service happens over a named pipe, which itself is protected by access control.
* Jenkins then installs the actual agent as a Windows service, by using the WMI over DCOM, then it starts this service.

== Troubleshooting

See link:docs/troubleshooting.adoc[Troubleshooting WMI Windows Agents].

=== Useful links

* https://wiki.jenkins.io/display/JENKINS/Installing+Jenkins+as+a+Windows+service[Installing Jenkins as a Windows service]

=== Changelog

* See link:https://github.com/jenkinsci/windows-slaves-plugin/releases[GitHub Releases] for recent versions
* See link:./CHANGELOG.adoc[this page] for previous releases
